apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: argocd
resources:
  - "./argocd-vs.yaml"
  - "./create-client.yaml"
configMapGenerator:
  - name: client-script
    files:
      - "./create-client.sh"

secretGenerator:
  - name: argocd-secret
    type: Opaque
    literals:
      - admin.password=notused
      - oidc.keycloak.clientSecret=hbeT0fKekzgT0fGPMYV6On9cRcSHiU8b
    files:
      - oidc.keycloak.rootCA=secrets/root-ca.pem
generatorOptions:
  disableNameSuffixHash: true
  annotations:
    note: kustomize-generated
helmCharts:
- name: argo-cd
  releaseName: argocd
  repo: https://argoproj.github.io/argo-helm
  version: 5.52.0
  valuesInline:
    configs:
      cm:
        url: https://argocd.platform.local
        admin.enabled: "false"
        oidc.config: |
          name: keycloak
          issuer: https://kc.platform.local/realms/master
          clientID: argocd
          clientSecret: $oidc.keycloak.clientSecret
          requestedScopes: ["openid", "profile", "email", "groups"]
          rootCA: $oidc.keycloak.rootCA
        kustomize.buildOptions: --enable-helm
        application.resourceTrackingMethod: annotation
      rbac:
        policy.csv: |
          g, argocd-admin, role:admin
          g, argocd-viewer, role:readonly
      params:
        server.insecure: true
      secret:
        createSecret: false
      ssh:
        extraHosts: | # todo, remove this override once we have this all up on github
          nas ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPANqJRT0PLVvMtuJgHnQaZiPI1XCKtXs77JVMZg1FYH
          nas ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDWQKhV9GBx2ntxlpWS//G15Zv/L8ms/4ZNaPjq5p+iX2Q06ffxKyBt40seEFkY9kC7WcjaEnfCvUwCDW+Avqga0/6S6/BV2pOuU2SrZIEYbDv6AoRCkwqs36yuAHe8vMYyDDqOIEHRriobLY6vQKMGQnidibDzYGfy8yCOJotnK8yndGEM5Fz6LkJMN2cXTm8BM30Y4U3ChyQO1hxftK9bf9Xy4EBjryVN9pT09fLc10UncSH9P//xJJRAhB+3Ki7eRPCHMLYOYuwdXQ82aewx/YZALXwx7j8hRF9jVaKMI4mUwbAMrw7BlOyrvGVLPjNnbJvq6NefSI2/Vz6/dIlvXW1fg8IZ/3v+NBY/m3dRZP0hqkTxYsIIJwn+vW++ajvI05q2R9lYsmky/qm1WvEev6s2TfNdHuZDZhgtQltrZch/9PTRvSKZVGRoyPql2sXx44VkaU5XQrTRSJ8Quyr9SadvG+cWk5CQijROaZXiLi+YOPABRxN+/UhQ+/ItRuc=
          nas ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBMhcsdQUKb/pHHs2v4Ea+ZE2O0r5x413ItZCXQDyAnkGjm0tguFsRcJmihb6BZKN816bbMMDADSH2oN8pEf2nUQ=
          nas.local,192.168.0.139 ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBMhcsdQUKb/pHHs2v4Ea+ZE2O0r5x413ItZCXQDyAnkGjm0tguFsRcJmihb6BZKN816bbMMDADSH2oN8pEf2nUQ=

    dex:
      enabled: false
    